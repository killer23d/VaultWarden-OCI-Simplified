# VaultWarden-OCI-NG fail2ban jail configuration
# Protects against brute force attacks using Cloudflare API

[DEFAULT]
# Ban settings
bantime  = 1h
findtime = 10m
maxretry = 5
backend  = auto

# Use Cloudflare ban action
banaction = cloudflare

# Action using Cloudflare API. cfzone and cftoken are read from environment vars.
# --- P8 FIX: Use FAIL2BAN_API_TOKEN environment variable ---
action = %(banaction)s[name=%(name)s, cfzone="%(env_CLOUDFLARE_ZONE_ID)s", cftoken="%(env_FAIL2BAN_API_TOKEN)s"]
# Optional: Email notifications (configure SMTP first)
#           %(mta)s-whois[name=%(name)s, sender="%(sender)s", dest="%(destemail)s"]

[vaultwarden-admin]
enabled = true
# Port isn't needed for Cloudflare action, but kept for context
port     = http,https
filter   = vaultwarden-admin
logpath  = /var/log/caddy/access.log
maxretry = 3
bantime  = 2h
findtime = 5m
# Action uses DEFAULT defined above

[vaultwarden-api]
enabled  = true
port     = http,https
filter   = vaultwarden-api
logpath  = /var/log/caddy/access.log
maxretry = 10
bantime  = 30m
findtime = 10m
# Action uses DEFAULT defined above

[caddy-botsearch]
enabled  = true
port     = http,https
filter   = caddy-botsearch
logpath  = /var/log/caddy/access.log
maxretry = 2
bantime  = 24h
findtime = 1h
# Action uses DEFAULT defined above
