# Fail2Ban filter for VaultWarden API (Caddy JSON logs via JMESPath)
# File: /etc/fail2ban/filter.d/vaultwarden-api.conf

[Definition]

# Ban when URI contains /api or /identity and status is 401/403/404
failjmespath = [? (contains(request.uri, '/api') || contains(request.uri, '/identity')) && (response.status == 401 || response.status == 403 || response.status == 404) ].request.remote_ip

# Explicitly empty since logic is non-regex-based
ignoreregex =
