# Fail2Ban filter for common bots/scanners and vulnerable path probes (Caddy JSON logs via JMESPath)
# File: /etc/fail2ban/filter.d/caddy-botsearch.conf

[Definition]

# Ban if any of the following is true:
# 1) Probing known-vulnerable paths
# 2) User agent indicates common bot/scanner/crawler
# 3) 404 on executable script extensions
failjmespath = [? (contains(request.uri, '/.env') || contains(request.uri, '/wp-admin') || contains(request.uri, '/wp-login') || contains(request.uri, '/config') || contains(request.uri, '/.git') || contains(request.uri, '/phpMyAdmin')) || (contains(lower(user_agent), 'bot') || contains(lower(user_agent), 'crawler') || contains(lower(user_agent), 'scanner') || contains(lower(user_agent), 'spider')) || (response.status == 404 && (contains(request.uri, '.php') || contains(request.uri, '.asp') || contains(request.uri, '.jsp') || contains(request.uri, '.cgi'))) ].request.remote_ip

# Explicitly empty since logic is non-regex-based
ignoreregex =
